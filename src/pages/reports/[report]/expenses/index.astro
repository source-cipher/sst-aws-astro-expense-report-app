---
import Layout from '../../../../layouts/Layout.astro';
import type { Expense } from '../../../../shared/Expense';
import type { ExpenseReport } from '../../../../shared/ExpenseReport';

const reportId = Astro.params.report;

let reportsResponse = await fetch(`${import.meta.env.PUBLIC_EXPENSE_REPORT_API}reports/${reportId}`);
reportsResponse = await reportsResponse.json();

const expenseReport: ExpenseReport = reportsResponse as any; //*** MAYBE THE BACKEND FOR GET EXPENSES BY REPORT ID SHOULD ADD THE REPORT NAME AND ID ???

reportsResponse = await fetch(`${import.meta.env.PUBLIC_EXPENSE_REPORT_API}reports/${reportId}/expenses`);
reportsResponse = await reportsResponse.json();

const expenses: Expense[] = (reportsResponse as any)?.items || [];
---

<Layout title="Expenses">
  <div class="m-4 rounded-md gap-2 flex flex-col bg-slate-700 drop-shadow-md">
    <div class="flex justify-between m-2 ">
      <h1 class="text-3xl font-bold text-white">{expenseReport?.name} Expenses</h1>
      <button id="add-expense" class="self-end drop-shadow-md rounded-md p-1 px-3 bg-emerald-600 text-white hover:bg-emerald-700">Add Expense</button>
    </div>
    <table class="flex flex-col">
      <thead class="p-2 uppercase bg-slate-600 text-slate-400">
        <tr class="grid grid-cols-2 text-left">
          <th>Description</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody class="rounded-br-md rounded-bl-md">
        {expenses.map((expense) => (
          <tr class="grid grid-cols-2 text-left border-b border-slate-500 last:border-0 p-2">
            <td class="text-slate-200">{expense.description}</td>
            <td class="text-slate-400">{expense.amount}</td>
          </tr>
        ))}
      </tbody>
    </table>
    <!--*** <div class="text-center">
      <button class="drop-shadow-md rounded-md p-1 px-3 m-2 bg-slate-600 text-white hover:bg-slate-800">Load More</button>
    </div> -->
  </div>
  
  <div class="bg-slate-700 m-4 rounded-md grid grid-cols-2 text-left p-2 text-slate-200">
    <span>
      Total
    </span>
    <span>
      789
    </span>
  </div>
</Layout>


<script>
  const addExpenseButton = document.getElementById('add-expense');
  addExpenseButton?.addEventListener('click', () => {
    window.location.assign(`expenses/add`);
  });
</script>